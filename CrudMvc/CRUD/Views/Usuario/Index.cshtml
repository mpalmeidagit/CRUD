@model List<CRUD.Models.UsuarioModel>

@{
    ViewBag.Title = "Cadastrar Usuário";

}
<style>
    #tbl_usuarios > thead > tr > th:nth-child(1) {
        width: 20%;
    }

    #tbl_usuarios > thead > tr > th:nth-child(2) {
        width: 20%;
    }

    #tbl_usuarios > thead > tr > th:nth-child(3) {
        width: 23%;
    }

    #tbl_usuarios > thead > tr > th:nth-child(4) {
        width: 23%;
    }

    #tbl_usuarios > thead > tr > th:nth-child(6) {
        text-align: center;
        width: 23%;
    }

    .btn_incluir {
        padding: 0px 0px 0px 0px;
        margin-top: 15px;
        margin-bottom: 40px;
    }

    .modal-dialog {
        width: 50%;
    }

    .margem_bottom_default {
        margin-bottom: 20px;
    }

    div.dataTables_length select {
        width: 100px;
        border-radius: 3px;
        padding: 4px;
    }

    div.dataTables_filter input {
        width: 16em;
        border-radius: 3px;
        padding: 4px;
        border: 1px solid #808080;
    }

    .form-horizontal .form-group {
        margin-right: 0px;
        margin-left: 0px;
    }

    .btn_center {
        text-align: center;
    }

    .tela_cadastro_default {
        margin-top: 20px;
    }
</style>
<div class="container home conteudo_painel">
  
    <div class="panel panel-primary tela_cadastro_default">

        <div class="panel-heading">
            @ViewBag.Title
        </div>

        <div class="panel-body">
            @Html.AntiForgeryToken()
            <div class="form-group col-md-6">

                @Html.Label("txt_nome", "Nome", new { @class = "control-label" })
                @Html.TextBox("txt_nome", null, new { @class = "form-control" })

            </div>
            <div class="form-group col-md-6">

                @Html.Label("txt_email", "Email", new { @class = "control-label" })
                @Html.TextBox("txt_email", null, new { @class = "form-control" })

            </div>

            <div class="form-group  col-md-6">

                @Html.Label("txt_login", "Login", new { @class = "control-label" })
                @Html.TextBox("txt_login", null, new { @class = "form-control" })

            </div>
            <div class="form-group col-md-6">

                @Html.Label("txt_senha", "Senha", new { @class = "control-label" })
                @Html.Password("txt_senha", null, new { @class = "form-control" })

            </div>
            <div class="col-md-3">
                <a id="btn_incluir" role="button" class="btn btn-success btn-block"><span class="glyphicon glyphicon-ok-sign"></span> Incluir Novo Usuário</a>

            </div>
            <div class="col-md-3">
                <a id="btn_cancelar" role="button" class="btn btn-danger btn-block"><span class="glyphicon glyphicon-remove-sign"></span> Cancelar</a>

            </div>
        </div>

    </div>
    <div class="col-md-12">
        <div id="msg_aviso" class="alert alert-danger invisivel">Falta preencher campos acima.</div>
        <div id="msg_erro" class="alert alert-danger invisivel">Ops! ocorreu algum erro!</div>
        <div id="msg_mensagem_aviso" class="text-danger invisivel"></div>
    </div>
</div>


@section Scripts{

    <script type="text/javascript">
        //var url_cadastrar = '@Url.Action("CadastrarUsuario", "Usuario")';

        function add_anti_forgery_token(data) {
            data.__RequestVerificationToken = $('[name=__RequestVerificationToken]').val();
            return data;
        }

        function LimparCampos() {
            var CampoNome = $("#txt_nome").val('');
            var CampoEmail = $("#txt_email").val('');
            var CampoLogin = $("#txt_login").val('');
            var CampoSenha = $("#txt_senha").val('');
        }


        $(document).on('click', '#btn_incluir', function () {
            var btn = $(this),
                 url = '@Url.Action("SalvarUsuario", "Usuario")',
                param = {
                    Id: $('#id_cadastro').val(),
                    Nome: $('#txt_nome').val(),
                    Email: $('#txt_email').val(),
                    Login: $('#txt_login').val(),
                    Senha: $('#txt_senha').val()
                };
            if (param.Nome == "") {
                $('#txt_nome').focus();
                swal({
                    type: 'error',
                    position: 'top',
                    title: 'Aviso',
                    text: 'Campo nome é obrigatório',
                })
            } else if (param.Email == "") {
                $('#txt_email').focus();
                swal({
                    type: 'error',
                    position: 'top',
                    title: 'Aviso',
                    text: 'Campo email é obrigatório',
                })
            } else if (param.Login == "") {
                $('#txt_login').focus();
                swal({
                    type: 'error',
                    position: 'top',
                    title: 'Aviso',
                    text: 'Campo login é obrigatório',
                })
            }
            else if (param.Senha == "") {
                $('#txt_senha').focus();
                swal({
                    type: 'error',
                    position: 'top',
                    title: 'Aviso',
                    text: 'Campo senha é obrigatório',
                })
            } else {
                $.post(url, add_anti_forgery_token(param), function (response) {
                    if (response.Resultado == "SUCESSO") {
                        if (param.Id == 0) {
                            param.Id = response.IdSalvo; 
                        }
                        swal({
                            position: 'top',
                            type: 'success',
                            text: 'Operação realizada com sucesso.',
                            showConfirmButton: false,
                            timer: 2500
                        });
                        LimparCampos();
                    }
                    else if (response.Resultado == "ERRO") {
                        $('#msg_aviso').hide();
                        $('#msg_mensagem_aviso').hide();
                        $('#msg_erro').show();
                    }
                    else if (response.Resultado == "AVISO") {
                        $('#msg_mensagem_aviso').html(formatar_mensagem_aviso(response.Mensagens));
                        $('#msg_aviso').show();
                        $('#msg_mensagem_aviso').show();
                        $('#msg_erro').hide();
                    }
                });
            }
        })
          .on('click', '#btn_cancelar', function () {
              LimparCampos();
              $("#txt_nome").focus();
          });



        function formatar_mensagem_aviso(mensagens) {
            var retorno = '';
            for (var i = 0; i < mensagens.length; i++) {
                retorno += '<li>' + mensagens[i] + '</li>';
            }

            return '<ul>' + retorno + '</ul>';
        }


    </script>

    <script src="~/Scripts/Cadastro/usuario.js"></script>

}




